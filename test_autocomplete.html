<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Agent Autocomplete</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input { width: 100%; padding: 10px; font-size: 16px; }
        .suggestions { 
            border: 1px solid #ccc; 
            max-height: 200px; 
            overflow-y: auto;
            background: white;
            margin-top: 5px;
        }
        .suggestion { 
            padding: 10px; 
            cursor: pointer; 
            border-bottom: 1px solid #eee;
        }
        .suggestion:hover { background: #f0f0f0; }
        .debug { 
            margin-top: 20px; 
            padding: 10px; 
            background: #f5f5f5; 
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container" x-data="testApp()">
        <h1>Test Agent Autocomplete</h1>
        <input 
            type="text" 
            x-model="input" 
            @input="checkForAgent()"
            placeholder="Type @ to see agents">
        
        <div class="suggestions" x-show="suggestions.length > 0">
            <div class="suggestion" 
                 x-for="s in suggestions" 
                 :key="s.name"
                 @click="selectAgent(s)">
                <strong x-text="s.command"></strong> - 
                <span x-text="s.description"></span>
            </div>
        </div>
        
        <div class="debug">
            <h3>Debug Info:</h3>
            Input: <span x-text="input"></span>
            At Position: <span x-text="atPosition"></span>
            Prefix: <span x-text="prefix"></span>
            Suggestions Count: <span x-text="suggestions.length"></span>
            Show Suggestions: <span x-text="showSuggestions"></span>
            API Response: <span x-text="JSON.stringify(apiResponse, null, 2)"></span>
        </div>
    </div>
    
    <script>
    function testApp() {
        return {
            input: '',
            suggestions: [],
            showSuggestions: false,
            atPosition: -1,
            prefix: '',
            apiResponse: null,
            
            async checkForAgent() {
                const atIndex = this.input.lastIndexOf('@');
                this.atPosition = atIndex;
                
                if (atIndex >= 0 && (atIndex === 0 || this.input[atIndex - 1] === ' ')) {
                    this.prefix = this.input.substring(atIndex + 1);
                    await this.fetchSuggestions(this.prefix);
                } else {
                    this.suggestions = [];
                    this.showSuggestions = false;
                }
            },
            
            async fetchSuggestions(prefix) {
                try {
                    const url = `/api/claude-code-agents/suggestions/${prefix || '_all'}`;
                    console.log('Fetching:', url);
                    const response = await fetch(url);
                    const data = await response.json();
                    this.apiResponse = data;
                    this.suggestions = data;
                    this.showSuggestions = data.length > 0;
                    console.log('Got suggestions:', data);
                } catch (error) {
                    console.error('Error:', error);
                    this.apiResponse = { error: error.message };
                }
            },
            
            selectAgent(agent) {
                const atIndex = this.input.lastIndexOf('@');
                this.input = this.input.substring(0, atIndex) + agent.command + ' ';
                this.suggestions = [];
                this.showSuggestions = false;
            }
        }
    }
    </script>
</body>
</html>